/* http://farski.github.com/jquery-blend/license.txt */
(function(l){l.fn.blend=function(j){function c(b,a){this.algorithm=b;this.precision=a;this.process=function(g,i){if(this.precision!="subpixel")return[this.algorithm(g[0],i[0]),this.algorithm(g[1],i[1]),this.algorithm(g[2],i[2])]}}j=l.extend({mode:"normal",adjustment:"rgb(128, 128, 128)",opacity:1},j);var q={normal:new c(function(b,a){return a}),darken:new c(function(b,a){return Math.min(b,a)}),multiply:new c(function(b,a){return b*a/255}),colorburn:new c(function(b,a){return a<=0?0:Math.max(255-(255-
b)*255/a,0)}),linearburn:new c(function(b,a){return Math.max(0,b+a-255)}),lighten:new c(function(b,a){return Math.max(b,a)}),screen:new c(function(b,a){return 255-(255-b)*(255-a)/255}),colordodge:new c(function(b,a){return a>=255?255:Math.min(b*255/(255-a),255)}),lineardodge:new c(function(b,a){return Math.min(b+a,255)}),overlay:new c(function(b,a){return b<128?2*b*a/255:255-2*(255-b)*(255-a)/255}),softlight:new c(function(b,a){return b<128?((a>>1)+64)*b*(2/255):255-(191-(a>>1))*(255-b)*(2/255)}),
hardlight:new c(function(b,a){return a<128?2*b*a/255:255-2*(255-b)*(255-a)/255}),difference:new c(function(b,a){return Math.abs(b-a)}),exclusion:new c(function(b,a){return 255-((255-b)*(255-a)/255+b*a/255)}),subtract:new c(function(b,a){return Math.max(b-a,0)})};return this.each(function(){if("getContext"in document.createElement("canvas"))this.onload=function(){var b=this,a=document.createElement("canvas"),g=a.getContext("2d");a.width=this.width;a.height=this.height;g.drawImage(this,0,0);var i=g.getImageData(0,
0,a.width,a.height),d=i.data,p=q[j.mode];if(j.adjustment.match(/^rgb/)){var k=j.adjustment.match(/rgb\(([0-9]+), ?([0-9]+), ?([0-9]+)/);k=[parseFloat(k[1],10),parseFloat(k[2],10),parseFloat(k[3],10)];for(var h=0;h<d.length;h+=4){var m=p.process([d[h],d[h+1],d[h+2]],k);d[h+0]=m[0];d[h+1]=m[1];d[h+2]=m[2]}g.putImageData(i,0,0);l(b).replaceWith(a)}else{var n=new Image;n.src=j.adjustment;n.onload=function(){var f=document.createElement("canvas"),e=f.getContext("2d");f.width=b.width;f.height=b.height;
e.drawImage(n,0,0);f=e.getImageData(0,0,f.width,f.height).data;for(e=0;e<d.length;e+=4){var o=p.process([d[e],d[e+1],d[e+2]],[f[e],f[e+1],f[e+2]]);d[e+0]=o[0];d[e+1]=o[1];d[e+2]=o[2]}g.putImageData(i,0,0);l(b).replaceWith(a)}}}})}})(jQuery);
